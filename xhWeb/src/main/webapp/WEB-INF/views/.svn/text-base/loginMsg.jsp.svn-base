<%@ page language="java" contentType="text/html; charset=UTF-8"
	pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core"%>
<%@ taglib uri="http://www.rapid-framework.org.cn/rapid" prefix="rapid"%>
<c:set var="ctx" value="${pageContext.request.contextPath}" />
<c:set var="rs" value="${ctx}/resources" />
<!DOCTYPE html>
<!-- 
Template Name: Metronic - Responsive Admin Dashboard Template build with Twitter Bootstrap 3.3.4
Version: 3.3.0
Author: KeenThemes
Website: http://www.keenthemes.com/
Contact: support@keenthemes.com
Follow: www.twitter.com/keenthemes
Like: www.facebook.com/keenthemes
Purchase: http://themeforest.net/item/metronic-responsive-admin-dashboard-template/4021469?ref=keenthemes
License: You must have a valid license purchased only from themeforest(the above link) in order to legally use the theme for your project.
-->
<!--[if IE 8]> <html lang="en" class="ie8 no-js"> <![endif]-->
<!--[if IE 9]> <html lang="en" class="ie9 no-js"> <![endif]-->
<!--[if !IE]><!-->
<html lang="en">
<!--<![endif]-->
<!-- BEGIN HEAD -->
<head>
<meta charset="utf-8"/>
<title>宁波市社会信用工作平台</title>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<meta http-equiv="Content-type" content="text/html; charset=utf-8">
<meta content="" name="description"/>
<meta content="" name="author"/>
<!-- BEGIN GLOBAL MANDATORY STYLES -->
<link href="${rs}/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN PAGE LEVEL STYLES -->
<link href="${rs}/admin/pages/css/login.css" rel="stylesheet" type="text/css"/>
<!-- END PAGE LEVEL SCRIPTS -->
<!-- BEGIN THEME STYLES -->
<link href="${rs}/global/css/components-rounded.css" id="style_components" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/admin/layout/css/layout.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/admin/layout/css/themes/default.css" rel="stylesheet" type="text/css" id="style_color"/>
<link href="${rs}/admin/layout/css/custom.css" rel="stylesheet" type="text/css"/>
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
<!-- forget -->
<link href="${rs}/global/plugins/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/simple-line-icons/simple-line-icons.min.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/bootstrap/css/bootstrap.min.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/uniform/css/uniform.default.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/bootstrap-switch/css/bootstrap-switch.min.css" rel="stylesheet" type="text/css"/>
<!-- END GLOBAL MANDATORY STYLES -->
<!-- BEGIN PAGE LEVEL PLUGIN STYLES -->
<link href="${rs}/global/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/fullcalendar/fullcalendar.min.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/jqvmap/jqvmap/jqvmap.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/plugins/morris/morris.css" rel="stylesheet" type="text/css">
<!-- END PAGE LEVEL PLUGIN STYLES -->
<!-- BEGIN PAGE STYLES -->
<link href="${rs}/admin/pages/css/tasks.css" rel="stylesheet" type="text/css"/>
<!-- END PAGE STYLES -->
<!-- BEGIN THEME STYLES -->
<!-- DOC: To use 'rounded corners' style just load 'components-rounded.css' stylesheet instead of 'components.css' in the below style tag -->
<link href="${rs}/global/css/components-rounded.css" id="style_components" rel="stylesheet" type="text/css"/>
<link href="${rs}/global/css/plugins.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/admin/layout4/css/layout.css" rel="stylesheet" type="text/css"/>
<link href="${rs}/admin/layout4/css/themes/light.css" rel="stylesheet" type="text/css" id="style_color"/>
<link href="${rs}/admin/layout4/css/custom.css" rel="stylesheet" type="text/css"/>

<!--bootstrap modal-->
<link href="${rs}/js/plugins/bootstrap-dialog/css/bootstrap-dialog.min.css" rel="stylesheet" type="text/css" />
<link href="${rs}/global/plugins/jquery-file-upload/css/jquery.fileupload-ui.css" rel="stylesheet" type="text/css" />
<link href="${rs}/global/plugins/jquery-file-upload/css/jquery.fileupload.css" rel="stylesheet" type="text/css" />
<link rel="stylesheet" href="${rs}/css/zTree/zTreeStyle/zTreeStyle.css" type="text/css">

 <LINK href="${rs}/js/style.css" rel="stylesheet" type="text/css">
<!--bootstrap modal-->
<rapid:block name="css"></rapid:block>	
<!-- END THEME STYLES -->
<link rel="shortcut icon" href="favicon.ico"/>
</head>
<!-- END HEAD -->
<!-- BEGIN BODY -->
<body class="maina">
<div class="login">
<!-- BEGIN SIDEBAR TOGGLER BUTTON -->
<div class="menu-toggler sidebar-toggler">
</div>
<!-- END SIDEBAR TOGGLER BUTTON -->
<!-- BEGIN LOGO -->
<object id="oCAPICOM"
     codeBase=" ${rs}/client/capicom.cab #version=2,0,0,3"
       classid="clsid:A996E48C-D3DC-4244-89F7-AFA33EC60679" style="display:none;">
</object>
<div class="logo"> 	
	
	<img src="${rs}/admin/layout4/img/logo-big.png" alt=""/>
</div>
<!-- END LOGO -->
<!-- BEGIN LOGIN -->

<div class="content" style="height:270px">
	<!-- BEGIN LOGIN FORM -->
  
	    <div>
       <h3 class="form-title">登录验证</h3></div>
       <span style="color: red;"><c:out value="${message}"/><c:out value="${msg}"/></span>
       <div class="alert alert-danger display-hide" style="height:10%;">
			<button class="close" data-close="alert"></button>
			<span> </span>
		</div>
       <div class="form-group">
			<!--ie8, ie9 does not support html5 placeholder, so we just show field title for that-->
			<label class="control-label visible-ie8 visible-ie9">手机号码</label>
			<input class="form-control form-control-solid placeholder-no-fix" type="text" autocomplete="off" placeholder="手机号"  id="TEL"  value="${TEL}"  disabled="disabled"/>
		</div>
		<div class="form-group">
			<label class="control-label visible-ie8 visible-ie9">验证码</label>
			<div class="form-inline"> 
				<input class="form-control form-control-solid placeholder-no-fix" type="text" autocomplete="off" placeholder="验证码" id="YZM"  style="width:55%;"  />
				<button  type="button" class="btn btn-primary btn-sm" style=" height:40px;"  id="second" >发送验证码</button>
			</div>
		</div>
		<div style="height:10px;"></div>
		<div class="form-actions text-center" >
		     <div><button type="button" class="btn btn-success uppercase" style=" width:100px; "  onclick="checkMsg()">确定</button></div>
		</div>
	   
</div>
<div class="copyright">
	 <div>2015 © 宁波市公共信用信息平台</div>
	 <div>技术支持联系电话：0574-83873513   0574-87360806 </div>
	 <div>平台需使用微软公司IE8.0或以上版本</div>
</div>
   <div id="bgDiv" class = "loginbgDiv"   style="display:none;position:absolute;top:0;background:#777;filter:progid:DXImageTransform.Microsoft.Alpha(style=3,opacity=25,finishOpacity=75);opacity:0.7;left:0;"> 
   </div>
 

<!-- END LOGIN -->
<!-- BEGIN JAVASCRIPTS(Load javascripts at bottom, this will reduce page load time) -->
<!-- BEGIN CORE PLUGINS -->
<!--[if lt IE 9]>
<script src="${rs}/global/plugins/respond.min.js"></script>
<script src="${rs}/global/plugins/excanvas.min.js"></script> 
<![endif]-->
<script src="${rs}/global/plugins/jquery.min.js" type="text/javascript"></script>
<script src="${rs}/global/plugins/jquery-migrate.min.js" type="text/javascript"></script>
<script src="${rs}/global/plugins/bootstrap/js/bootstrap.min.js" type="text/javascript"></script>
<script src="${rs}/global/plugins/jquery.blockui.min.js" type="text/javascript"></script>
<script src="${rs}/global/plugins/uniform/jquery.uniform.min.js" type="text/javascript"></script>
<script src="${rs}/global/plugins/jquery.cokie.min.js" type="text/javascript"></script>
<!-- END CORE PLUGINS -->
<!-- BEGIN PAGE LEVEL PLUGINS -->
<script src="${rs}/global/plugins/jquery-validation/js/jquery.validate.min.js" type="text/javascript"></script>
<!-- END PAGE LEVEL PLUGINS -->
<!-- BEGIN PAGE LEVEL SCRIPTS -->
<script src="${rs}/global/scripts/metronic.js" type="text/javascript"></script>
<script src="${rs}/admin/layout/scripts/layout.js" type="text/javascript"></script>
<script src="${rs}/admin/layout/scripts/demo.js" type="text/javascript"></script>
<script src="${rs}/admin/pages/scripts/login.js" type="text/javascript"></script>
<script src="${rs}/js/plugins/layer/layer.js"></script>
<!-- END PAGE LEVEL SCRIPTS -->
<script>
jQuery(document).ready(function() {     
	Metronic.init(); // init metronic core components
	Layout.init(); // init current layout
	Login.init();
	Demo.init();
	
    $("#second").click(function (){
    	sendMsg($("#second"));
    });
    
    v = getCookieValue("secondsremained")?getCookieValue("secondsremained"):0//获取cookie值
    		
    if(v>0){
        settime($("#second"));//开始倒计时
    }
    
});

//开始倒计时
var countdown;
function settime(obj) { 
    countdown=getCookieValue("secondsremained");
    if (countdown == 0) { 
        obj.removeAttr("disabled");    
        obj.text("发送验证码");  
       return;
    } else { 
        obj.attr("disabled", true); 
         obj.text("重新发送(" + countdown + ")"); 
        countdown--;
        editCookie("secondsremained",countdown,countdown+1);
    } 
    setTimeout(function() { settime(obj) },1000) //每1000毫秒执行一次
} 

//发送验证码
function sendMsg(obj){
	var tel=$('#TEL').val();
	 
	if((tel.replace(/(^s*)|(s*$)/g, "").length >0) ){
		   $.ajax({
		    	 url: '${ctx}/sendMsg/',
		         type: "POST",
		         data: {tel:tel},
		         dataType: "json"
		    }).done(function(data,ss) {
	    		if(data=='1'){
	    			//发送成功
	    			layer.msg('发送成功');
	    		}else if(data=='2'){
	    			//电话号码为空
	    			layer.msg('电话号码为空');
	    		}else{
	    			//失败
	    			layer.msg('验证码发送失败');
	    		}
	   		});
		   
		   //倒计时
		  // addCookie("secondsremained",60,60);//添加cookie记录,有效时间60s  
		   addCookie("secondsremained",60,60);//添加cookie记录,有效时间s  
	       settime(obj);//开始倒计时
	       
	}else{
		layer.msg('error');
	}
 
}

//检验验证码
function checkMsg(){
	
	var tel=$('#TEL').val();
	var yzm=$('#YZM').val();
	
	if((tel.replace(/(^s*)|(s*$)/g,"").length >0)&& (yzm.replace(/(^s*)|(s*$)/g, "").length >0)){
		   $.ajax({
		    	 url: '${ctx}/checkMsg/',
		         type: "POST",
		         data: {TEL:tel,YZM:yzm},
		         dataType: "json"
		    }).done(function(data,ss) {
	    		 
		    	layer.msg(data.msg);
	    		if(data=='1'){
	    			//成功
	    			layer.msg('验证成功，正在进入首页...');
	    	        window.location.href = '${ctx}/index';
	    		}else{
	    			layer.msg('验证码校验失败');
	    		} 
	    		 
	   		});
	}else{
		layer.msg('请输入验证码。');
	}
	
}



</script>
 
<script type="text/javascript">
function show(){
	document.getElementById("bgDiv").style.display = "block";
	document.getElementById("calogin2").style.display = "block"; 
}
function ex(){
	 document.getElementById("bgDiv").style.display = "none";
	 document.getElementById("calogin2").style.display = "none"; 
}

//验证码倒计时
//发送验证码时添加cookie
function addCookie(name,value,expiresHours){ 
    var cookieString=name+"="+escape(value); 
    //判断是否设置过期时间,0代表关闭浏览器时失效
    if(expiresHours>0){ 
        var date=new Date(); 
        date.setTime(date.getTime()+expiresHours*1000); 
        cookieString=cookieString+";expires=" + date.toUTCString(); 
    } 
        document.cookie=cookieString; 
} 
//修改cookie的值
function editCookie(name,value,expiresHours){ 
    var cookieString=name+"="+escape(value); 
    if(expiresHours>0){ 
      var date=new Date(); 
      date.setTime(date.getTime()+expiresHours*1000); //单位是毫秒
      cookieString=cookieString+";expires=" + date.toGMTString(); 
    } 
      document.cookie=cookieString; 
} 
//根据名字获取cookie的值
function getCookieValue(name){ 
      var strCookie=document.cookie; 
      var arrCookie=strCookie.split("; "); 
      for(var i=0;i<arrCookie.length;i++){ 
        var arr=arrCookie[i].split("="); 
        if(arr[0]==name){
          return unescape(arr[1]);
          break;
        }else{
             return ""; 
             break;
         } 
      } 
       
}

</script>
</div>
</body>
</html>